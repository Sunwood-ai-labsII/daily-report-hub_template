name: ğŸ“Š ãƒ‡ã‚¤ãƒªãƒ¼ãƒ¬ãƒãƒ¼ãƒˆãƒãƒ–åŒæœŸ v2.4 (YUKIHIKO PRç‰ˆ)
on:
  push:
    branches: [main, master]
  pull_request:
    types: [opened, synchronize, closed]

env:
  WEEK_START_DAY: 1
  AUTO_APPROVE: true
  AUTO_MERGE: true  
  CREATE_PR: true

jobs:
  sync-data:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ ç¾åœ¨ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ”§ ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œå¯èƒ½ã«ã™ã‚‹
        run: chmod +x .github/scripts/*.sh

      - name: ğŸ“… é€±æƒ…å ±ã‚’è¨ˆç®—
        run: ./.github/scripts/calculate-week-info.sh ${{ env.WEEK_START_DAY }}

      - name: ğŸ” Gitæ´»å‹•ã‚’åˆ†æ
        run: ./.github/scripts/analyze-git-activity.sh

      - name: ğŸ“ Markdownãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆ
        run: ./.github/scripts/generate-markdown-reports.sh

      - name: ğŸ“‚ ãƒ¬ãƒãƒ¼ãƒˆãƒãƒ–ã‚’ã‚¯ãƒ­ãƒ¼ãƒ³
        env:
          GITHUB_TOKEN: ${{ secrets.GH_PAT }}
          REPORT_HUB_REPO: ${{ vars.REPORT_HUB_REPO || 'Sunwood-ai-labsII/daily-report-hub' }}
        run: |
          git config --global user.name "GitHub Actions Bot"
          git config --global user.email "actions@github.com"
          git clone https://x-access-token:${GITHUB_TOKEN}@github.com/${REPORT_HUB_REPO}.git daily-report-hub

      - name: ğŸ—ï¸ Docusaurusæ§‹é€ ã‚’ä½œæˆ
        run: ./.github/scripts/create-docusaurus-structure.sh

      - name: ğŸš€ YUKIHIKOæ¨©é™ã§PRä½œæˆï¼†è‡ªå‹•æ‰¿èª
        env:
          GITHUB_TOKEN_ORIGINAL: ${{ secrets.GH_PAT }}      # æ‰¿èªç”¨
          YUKIHIKO_TOKEN: ${{ secrets.GH_PAT_YUKIHIKO }}     # PRä½œæˆç”¨
          GITHUB_TOKEN: ${{ secrets.GH_PAT }}              # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
          REPORT_HUB_REPO: ${{ vars.REPORT_HUB_REPO || 'Sunwood-ai-labsII/daily-report-hub' }}
        run: ./.github/scripts/sync-to-hub-gh.sh
